{% extends "teacher_dashboard.html" %}
{% block content %}

<h2 class="mb-3">ðŸ“š Phonics Entry</h2>

<div class="card p-4 shadow-sm">

    <form action="{{ url_for('add_phonics_entry') }}" method="POST">

        <!-- Date -->
        <label class="mt-2">Date</label>
        <input type="date" name="date" class="form-control" required>

        <!-- Student Name -->
        <label class="mt-3">Student Name</label>
        <input type="text" name="student_name" class="form-control" required>

        <!-- Level -->
        <label class="mt-3">Level</label>
        <select name="level" class="form-select" id="levelSelect" required>
            <option value="" selected disabled>Select Level</option>
            {% for lvl in levels %}
            <option value="{{ lvl }}">{{ lvl }}</option>
            {% endfor %}
        </select>

        <!-- Book Dropdown (Dynamic) -->
        <label class="mt-3">Book Name</label>
        <select name="book_id" class="form-select" id="bookSelect" disabled required>
            <option value="">-- Select Book --</option>
        </select>

        <!-- Time Taken -->
        <label class="mt-3">Time Taken (in minutes)</label>
        <input type="number" name="time_taken" min="1" class="form-control" required>

        <!-- Feedback -->
        <label class="mt-3">Feedback</label>
        <textarea name="feedback" rows="3" class="form-control"></textarea>

        <button class="btn btn-success mt-4">Submit Entry</button>
    </form>
</div>

<hr class="my-4">

<h4>Saved Entries</h4>

{% if entries %}
<div class="list-group">
    {% for e in entries %}
    <div class="list-group-item">
        <strong>{{ e.student_name }}</strong>
        <span class="badge bg-info ms-2">{{ e.level }}</span>

        <p class="mt-2"><b>Book:</b> {{ e.book.original_name }}</p>
        <p><b>Date:</b> {{ e.date }}</p>
        <p><b>Time:</b> {{ e.time_taken }} mins</p>
        <p><b>Feedback:</b> {{ e.feedback }}</p>

        <form method="POST"
              action="{{ url_for('delete_phonics_entry', pid=e.id) }}"
              onsubmit="return confirm('Delete this entry?');">
            <button class="btn btn-danger btn-sm">Delete</button>
        </form>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No phonics entries added yet.</p>
{% endif %}

<!-- JS for dynamic book loading -->
<script>
document.getElementById("levelSelect").addEventListener("change", function () {
    const level = this.value;

    fetch(`/get_books_by_level/${level}`)
        .then(response => response.json())
        .then(data => {
            const bookSelect = document.getElementById("bookSelect");
            bookSelect.innerHTML = '<option value="">-- Select Book --</option>';

            if (data.length > 0) {
                data.forEach(b => {
                    const opt = document.createElement("option");
                    opt.value = b.id;
                    opt.textContent = b.original_name;
                    bookSelect.appendChild(opt);
                });
                bookSelect.disabled = false;
            } else {
                bookSelect.disabled = true;
            }
        });
});
</script>

{% endblock %}

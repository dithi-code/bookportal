<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resources</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: Poppins, sans-serif;
      background: #eef3ff;
      padding: 20px;
    }

    .logout-btn {
      position: absolute;
      top: 15px;
      right: 20px;
    }

    .page-title {
      font-weight: 700;
      font-size: 28px;
      text-align: center;
      margin-bottom: 25px;
      color: #2c3e50;
    }

    .book-card {
      padding: 12px 14px;
      margin: 6px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
      min-width: 180px;
    }

    .category-title {
      margin-top: 20px;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 1.05rem;
      color: #333;
    }
  </style>
</head>

<body>

<!-- LOGOUT BUTTON -->
<a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm logout-btn">Logout</a>

<div class="container">

  <!-- PAGE TITLE -->
  <div class="page-title">Teacher Books</div>

  <!-- TOP TABS: Books + Phonics -->
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active"
              id="books-tab"
              data-bs-toggle="tab"
              data-bs-target="#books"
              type="button"
              role="tab">
        Books
      </button>
    </li>

    <li class="nav-item ms-auto" role="presentation">
      <button class="nav-link"
              id="phonics-tab"
              data-bs-toggle="tab"
              data-bs-target="#phonics"
              type="button"
              role="tab">
        Phonics Entry
      </button>
    </li>
  </ul>

  <!-- MAIN TAB CONTENT -->
  <div class="tab-content mt-4">

    <!-- BOOKS TAB -->
    <div class="tab-pane fade show active" id="books" role="tabpanel" aria-labelledby="books-tab">
      <!-- LEVEL TABS -->
      <ul class="nav nav-tabs mt-3" role="tablist">
        {% for lvl in level_tabs %}
          <li class="nav-item">
            <button class="nav-link {% if loop.first %}active{% endif %}"
                    data-bs-toggle="tab"
                    data-bs-target="#level-{{ lvl | replace(' ','_') | lower }}">
              {{ lvl }}
            </button>
          </li>
        {% endfor %}
      </ul>

      <!-- LEVEL CONTENT -->
      <div class="tab-content mt-4">
        {% set categories = ['Story','Words','Workout','Comprehension','Test'] %}
        {% for lvl in level_tabs %}
          <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
               id="level-{{ lvl | replace(' ','_') | lower }}">
            {% for cat in categories %}
              {% set cat_books = [] %}
              {% for b in books_by_level[lvl] %}
                {% if (b.category or '')|lower == cat|lower %}
                  {% set _ = cat_books.append(b) %}
                {% endif %}
              {% endfor %}

              {% if cat_books|length > 0 %}
                <div class="category-title">{{ cat }}</div>
                <div class="d-flex flex-wrap">
                  {% for b in cat_books %}
                    <div class="book-card">
                      <strong>{{ b.original_name }}</strong><br>
                      <small>Level: {{ b.levels }}</small><br>
                      <a href="{{ url_for('view_book', book_id=b.id) }}"
                         class="btn btn-sm btn-primary mt-2">
                        View
                      </a>
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- PHONICS TAB -->
    <div class="tab-pane fade" id="phonics" role="tabpanel" aria-labelledby="phonics-tab">
      <div class="card p-4 mt-3">
        <h4>üóìÔ∏è Enter Daily Record</h4>

        <form method="POST" action="{{ url_for('phonics_tab') }}" id="phonicsForm">
          <div class="mb-3">
            <label>Date</label>
            <input type="date" name="date" class="form-control" required>
          </div>

          <div class="mb-3">
            <label>Student Name</label>
            <input type="text" name="student_name" class="form-control" required>
          </div>

          <div class="mb-3">
            <label>Level</label>
            <select name="level" class="form-select" id="levelSelectPhonics" required>
              <option value="" disabled selected>Select your level</option>
              {% for lvl in level_tabs %}
                <option value="{{ lvl }}">{{ lvl }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label>Book Name</label>
            <select name="book_id" class="form-select" id="bookSelectPhonics" disabled required>
              <option value="">--Select Book--</option>
            </select>
          </div>

          <div class="mb-3">
            <label>Time Taken (in minutes)</label>
            <input type="number" name="time_taken" class="form-control" required>
          </div>

          <div class="mb-3">
            <label>Feedback</label>
            <textarea name="feedback" class="form-control" rows="3"></textarea>
          </div>

          <button type="submit" class="btn btn-success">Submit Record</button>
        </form>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const levelSelect = document.getElementById("levelSelectPhonics");
    const bookSelect = document.getElementById("bookSelectPhonics");

    levelSelect.addEventListener("change", function() {
        const level = this.value;

        bookSelect.disabled = true;
        bookSelect.innerHTML = '<option value="">Loading books...</option>';

        fetch(`/get_books_by_level/${encodeURIComponent(level)}`)
            .then(response => response.json())
            .then(data => {
                bookSelect.innerHTML = '<option value="">--Select Book--</option>';
                data.forEach(book => {
                    const option = document.createElement("option");
                    option.value = book.id;
                    option.textContent = book.original_name;
                    bookSelect.appendChild(option);
                });
                bookSelect.disabled = data.length === 0;
            })
            .catch(err => {
                console.error("Error fetching books:", err);
                bookSelect.innerHTML = '<option value="">Error loading books</option>';
                bookSelect.disabled = true;
            });
    });
});
</script>

</body>
</html>

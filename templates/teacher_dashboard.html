{% extends "base.html" %}
{% block content %}

<h3 class="mb-4 text-center">Uploaded Books</h3>

<div class="card p-4">
    <!-- LEVEL TABS -->
    <ul class="nav nav-tabs mb-3" id="levelTabs" role="tablist">
        {% for lvl in level_tabs %}
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if loop.first %}active{% endif %}"
                    id="tab-{{ lvl | lower }}"
                    data-bs-toggle="tab"
                    data-bs-target="#level-{{ lvl | replace(' ','_') | lower }}"
                    type="button"
                    role="tab">
                {{ lvl }}
            </button>
        </li>
        {% endfor %}
    </ul>

    <!-- TAB CONTENT -->
    <div class="tab-content">
        {% for lvl in level_tabs %}
        <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
             id="level-{{ lvl | replace(' ','_') | lower }}"
             role="tabpanel">

            {% for cat in categories %}
            <h6 class="mt-3 mb-2">{{ cat }}</h6>
            <div class="d-flex flex-wrap">
                {% set has_books = false %}
                {% for b in books_by_level[lvl] %}
                    {% if (b.category or '')|lower == cat|lower %}
                        {% set has_books = true %}
                        <div class="book-card">
                            <strong>{{ b.title or b.original_name }}</strong><br>
                            <small>Level(s): {{ b.levels }}</small><br>
                            <a href="{{ url_for('view_book', book_id=b.id) }}" class="btn btn-sm gradient-btn mt-2">View</a>
                        </div>
                    {% endif %}
                {% endfor %}
                {% if not has_books %}
                    <div class="text-muted ms-2" style="font-style: italic;">No books in this category.</div>
                {% endif %}
            </div>
            {% endfor %}

        </div>
        {% endfor %}
    </div>
</div>
